
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pomeg-letterbombers.github.io/pokemon-ace-notes/technical-documentation/writing-hexwriter/">
      
      
        <link rel="prev" href="../../frlg/complex-payloads/hex-writer/">
      
      
        <link rel="next" href="../grab-ace-exit/">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Writing the hexwriter - pokemon-ace-notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+3:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Source Sans 3";--md-code-font:"Source Code Pro"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#preamble" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="pokemon-ace-notes" class="md-header__button md-logo" aria-label="pokemon-ace-notes" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pokemon-ace-notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Writing the hexwriter
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/pomeg-letterbombers/pokemon-ace-notes/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    pokemon-ace-notes
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="pokemon-ace-notes" class="md-nav__button md-logo" aria-label="pokemon-ace-notes" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    pokemon-ace-notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pomeg-letterbombers/pokemon-ace-notes/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    pokemon-ace-notes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    FireRed/LeafGreen
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            FireRed/LeafGreen
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frlg/getting-started/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Exit codes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Exit codes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frlg/exit-codes/box-14-exit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Box 14 exit code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frlg/exit-codes/exit-code-bootstrap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exit code bootstrap
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Complex payloads
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Complex payloads
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frlg/complex-payloads/hex-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hexwriter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Technical documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Technical documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Writing the hexwriter
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Writing the hexwriter
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preamble" class="md-nav__link">
    <span class="md-ellipsis">
      Preamble
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-storing-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Memory storing techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory storing techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mail-corruption" class="md-nav__link">
    <span class="md-ellipsis">
      Mail corruption
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#determining-the-initial-sbc-offset" class="md-nav__link">
    <span class="md-ellipsis">
      Determining the initial SBC offset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#box-name-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Box name codes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-and-acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      References and Acknowledgements
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grab-ace-exit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grab ACE exit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preamble" class="md-nav__link">
    <span class="md-ellipsis">
      Preamble
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-storing-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Memory storing techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory storing techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mail-corruption" class="md-nav__link">
    <span class="md-ellipsis">
      Mail corruption
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#determining-the-initial-sbc-offset" class="md-nav__link">
    <span class="md-ellipsis">
      Determining the initial SBC offset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#box-name-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Box name codes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-and-acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      References and Acknowledgements
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Writing the hexwriter</h1>

<h2 id="preamble">Preamble</h2>
<p>In December 2024, efforts has been started to simplify the writing of the hexadecimal writer (hexwriter) with the power of mail corruption being able to modify Pokémon data.
The version of the hexwriter guide present on this website was from one of these efforts.</p>
<h2 id="memory-storing-techniques">Memory storing techniques</h2>
<p>The main reason why this version of the hexwriter guide is shorter than the others is that it uses an unconventional form of <code>STR &lt;rd&gt;, [&lt;rn&gt;, #0x4]!</code>.
Usually the standard form of this instruction is unwritable using the US/European character encoding.</p>
<p>However with a scaled register offset, we can use the bit shifted value of a regsiter, and use that as the offset for <code>STR</code>.
Thankfully there are some bit-shift operations<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> available for use with the limited charset, allowing a way to write some <code>STR</code> instruction with unwritable offsets.
In addition, with writeback (<code>!</code>), it also increments by the offset which saves an <code>ADC</code> or <code>LDRSB</code> instruction used to increment <code>rn</code> to where we want to write our data to.
Below is what the instruction looks like in ARM assembly:</p>
<div class="highlight"><pre><span></span><code>STR &lt;rd&gt;, [&lt;rn&gt;, &lt;rm&gt;, LSR #nn]!
</code></pre></div>
<p><code>lr</code> is always initially a ROM address when executing grab ACE, where the most significant byte is always 0x8.
By performing a bit shift right (can be <code>LSR</code> or <code>ASR</code>) by 25, we can get an offset of 0x4 from <code>lr</code>, allowing the <code>STR</code> instruction to always write to <code>rn+4</code> which is highly useful for the hexwriter.</p>
<p>Since the hexwriter writing codes use <code>r12</code> to store the working values and <code>r11</code> to store the destination, the <code>STR</code> works out to what is shown below:</p>
<div class="highlight"><pre><span></span><code>E7ABCCAE    STR r12, [r11, lr, LSR #25]!
</code></pre></div>
<h3 id="mail-corruption">Mail corruption</h3>
<p>In FireRed/LeafGreen, mail corruption allows directly writing into the first 9 halfwords of Box 3, Slot 1.
This allows for (mostly) bypassing the need to use arithmetic to compute bytes 0-17 of the hexwriter.</p>
<p>Even when there is not a easy chat system word with an index that corresponds to a halfword within the hexwriter data, there is certainly a word where the lower 8 bits of the index matches.
As such, a single <code>MOVS</code> and <code>STRB</code> can be used to overwrite the upper 8 bits of the halfword in this case.</p>
<p>When choosing mail words to write, words that were available by default were chosen over unlockable words whenever possible.
If the only word options are unlockable words then words that are likely to be unlocked in a regular playthrough of FR/LG are given priority over other unlockable words.
In cases where the only words available are words that are locked to the post game or needs a time-consuming extra step, <code>STRH</code> is used to fill in the space instead.
Below is the mail message with the words substituted for their respective hexadecimal indexes:</p>
<div class="highlight"><pre><span></span><code>2A8A    2A8F
0E00    0000
0402    045C
0466    044F
1009
</code></pre></div>
<details class="question">
<summary>What about mail word 4?</summary>
<p>At the time it was considered that using mail word 4 is simply not worth it, due to all of the candidates for it being only unlockable in the post-game.
However it is found to be possible to unlock one of the candidates via unlocking the National Dex from running the script via NPC.
Still the savings from using that word is only 4 characters, and the player would still need to go out of their way to unlock the National Dex before using it, so it was omitted.
Below is the word that can be feasibly unlocked before the post game.</p>
<table>
<thead>
<tr>
<th>Word</th>
<th>Index (hex)</th>
</tr>
</thead>
<tbody>
<tr>
<td>AZUMARILL</td>
<td>2AB8</td>
</tr>
</tbody>
</table>
<p>Here is the orignal code 1 that used mail word 4:</p>
<div class="highlight"><pre><span></span><code>Box  1: C C U n 7 T … o [CCUn7T…o]
Box  2: _ _ _ 7 F Q q _ [   7FQq ]
Box  3: _ _ n F … o _ _ [  nF…o  ]
Box  4: _ 9 F Q q _ _ _ [ 9FQq   ]
Box  5: t F … o – F Q q [tF…o–FQq]
Box  6: _ _ _ o F … o _ [   oF…o ]
Box  7: _ _ ” F Q q _ _ [  ”FQq  ]
Box  8: _ F F … o _ _ _ [ FF…o   ]
Box  9: ’ F Q q N G … o [’FQqNG…o]
Box 10: _ _ _ ♀ F w q _ [   ♀Fwq ]
Box 11: _ _ s R … o _ _ [  sR…o  ]
Box 12: _ d F ? n _ _ _ [ dF?n   ]
Box 13: ‘ F Q m _ _ _ _ [‘FQm    ]
</code></pre></div>
</details>
<h2 id="determining-the-initial-sbc-offset">Determining the initial <code>SBC</code> offset</h2>
<p>With the right immediate for the initial <code>SBC</code> instruction used to set the value of <code>r11</code>, an initial <code>STR</code> instruction can be used to both store the first data value, and advance <code>r11</code> all at once.</p>
<ul>
<li>This removes an additional <code>ADC</code>/<code>SBC</code> or <code>LDRH</code>/<code>LDRSB</code> usually used to further adjust <code>r11</code>.</li>
</ul>
<p>To be able to use the initial large <code>STR</code> offset, this immediate must set <code>r11</code> to an address at least 0xA1 bytes before the box slot as that is the first writable offset after 0x0 (space).</p>
<ul>
<li>Due to the <code>pc</code> register having a value that is always 0xA<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup> ahead of BOX_NAMES_START, and <code>shifter_operand</code> being restricted to <code>0x0</code>-<code>0xFF</code> bit rotated right by a multiple of 2, 0xA1 cannot be used as all immediates that have an offset of 0xA1 before a box slot are all located within Box 14.</li>
<li>Due to <code>SBC</code> always adding an additional subtraction by ~CARRY_FLAG (which is always 1 under normal circumstances), the <code>STR</code> offset has +1 added to account for this.</li>
<li>This leaves 0xA7 as the lowest possible offset that can be used as the first initial <code>STR</code> offset, let this be PID_OFFSET</li>
</ul>
<p>As such immediate needs to satify the below equation:</p>
<ul>
<li>(BOX_NAMES_START + 0xA) - immediate - 1 = BOX_SLOT_ADDRESS - 0xA7<ul>
<li>The value of <code>pc</code> is the address of the current instruction + 0xA when <code>pc</code> is misaligned (executed from 0x351)</li>
<li>Since the instruction is <code>SBC</code>, the immediate is subtracted by ~CARRY_FLAG which is always <code>1</code> under normal circumstances</li>
</ul>
</li>
</ul>
<p>Using the below algorithm, a list of immediates that satisfy the above equation can be generated:</p>
<div class="highlight"><pre><span></span><code>BIT_LENGTH &lt;- 32
BIT_MASK &lt;- 2**BIT_LENGTH - 1
VALID_CHARS &lt;- [...] # Codepoints of every writable character
VALID_IMMEDIATES &lt;- {
    (c &gt;&gt; i * 2) | ((c &lt;&lt; (BIT_LENGTH - i * 2)) &amp; BIT_MASK)
    FOR i IN range(0, 16)
    FOR c IN VALID_CHARS
    }
BOX_MON_SIZE &lt;- 80
BOXES &lt;- 14
SLOTS &lt;- 30
PC_OFFSET &lt;- 8 # SUB and aligned pc offsets is easier to remember
PID_OFFSET &lt;- 0xA8
offsets &lt;- []
distance &lt;- PC_OFFSET
FOR box_number IN range(BOXES, 0, -1):
    FOR box_slot IN range(SLOTS, 0, -1):
        distance &lt;- distance + BOX_MON_SIZE
        if (offset &lt;- distance + PID_OFFSET) in VALID_IMMEDIATES:
            offsets.add([box_number, box_slot, offset])
</code></pre></div>
<p>Immediate 0x2F40 was found which targets Box 10, Slot 2, let this be INITIAL_OFFSET.</p>
<h2 id="box-name-codes">Box name codes</h2>
<p>Each box name code starts with this instruction:</p>
<div class="highlight"><pre><span></span><code>SBC r11, pc, INITIAL_OFFSET
</code></pre></div>
<p>Codes are generally structured as the following:</p>
<ul>
<li>
<p>All of them generally start with the following instructions:
  <div class="highlight"><pre><span></span><code>MOV r12, { data } ? ; Some data is computed by hand instead
</code></pre></div></p>
</li>
<li>
<p>The first 32-bit word stored use this <code>STR</code> instruction:
  <div class="highlight"><pre><span></span><code>STR r12, [r11, { PID_OFFSET + offset }]!
</code></pre></div></p>
</li>
<li>
<p>All other words after the first use this <code>STR</code> instruction:
  <div class="highlight"><pre><span></span><code>STR r12, [r11, lr, LSR #25]!
</code></pre></div></p>
</li>
<li>
<p>Code 1 is an exception, all bytes and halfwords (except for the last byte and halfword) in that code is structured like the following:
  <div class="highlight"><pre><span></span><code>STRB r12, [r11, { PID_OFFSET + offset }] ; STRH for halfword
</code></pre></div></p>
</li>
<li>
<p>The last byte type data stored in Code 1 is structured like this (to get around STRH offset limitations):
  <div class="highlight"><pre><span></span><code>STRB r12, [r11, { PID_OFFSET + offset }]!
</code></pre></div></p>
</li>
<li>
<p>The last halfword in Code 1 stored uses the following instruction:
  <div class="highlight"><pre><span></span><code>STRH r12, [r11, {offset - last_byte_offset}]
</code></pre></div></p>
</li>
</ul>
<p>Below is a table, mapping each word (4-byte sequence) to at least an offset in the box name codes.</p>
<div class="admonition note inline end">
<p class="admonition-title">Legend</p>
<ul>
<li>Each offset has a type associated with it, corresponding to the <code>STR</code> type used for the data.</li>
<li><strong>Boldface</strong> indicates that the highlighted part was written by mail corruption.</li>
</ul>
</div>
<table>
<thead>
<tr>
<th style="text-align: right;">Code No.</th>
<th style="text-align: left;">Data</th>
<th style="text-align: left;">Offset(s) (B/H/W)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: left;">E2<strong>8F</strong>80<strong>8A</strong></td>
<td style="text-align: left;">0x1 (B), 0x3 (B)</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: left;">E8B8<strong>0E00</strong></td>
<td style="text-align: left;">0x6 (H)</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: left;">E3<strong>5C0402</strong></td>
<td style="text-align: left;">0xB (B)</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: left;">32<strong>4F</strong>C0<strong>66</strong></td>
<td style="text-align: left;">0xD (B), 0xF (B)</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: left;">E7D8<strong>1009</strong></td>
<td style="text-align: left;">0x12 (H)</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td style="text-align: left;">E25110B1</td>
<td style="text-align: left;">0x14 (W)</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td style="text-align: left;">32911010</td>
<td style="text-align: left;">0x18 (W)</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td style="text-align: left;">5081B20B</td>
<td style="text-align: left;">0x1C (W)</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td style="text-align: left;">459CB000</td>
<td style="text-align: left;">0x20 (W)</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td style="text-align: left;">E31A0001</td>
<td style="text-align: left;">0x24 (W)</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td style="text-align: left;">14CCB001</td>
<td style="text-align: left;">0x28 (W)</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td style="text-align: left;">13A0B000</td>
<td style="text-align: left;">0x2C (W)</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td style="text-align: left;">E35A0007</td>
<td style="text-align: left;">0x30 (W)</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td style="text-align: left;">328AA001</td>
<td style="text-align: left;">0x34 (W)</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td style="text-align: left;">23A0A000</td>
<td style="text-align: left;">0x38 (W)</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td style="text-align: left;">22899001</td>
<td style="text-align: left;">0x3C (W)</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td style="text-align: left;">E2899001</td>
<td style="text-align: left;">0x40 (W)</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td style="text-align: left;">E359007E</td>
<td style="text-align: left;">0x44 (W)</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td style="text-align: left;">424FF040</td>
<td style="text-align: left;">0x48 (W)</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td style="text-align: left;">E12FFF10<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup></td>
<td style="text-align: left;">0x4C (W)</td>
</tr>
</tbody>
</table>
<h2 id="references-and-acknowledgements">References and Acknowledgements</h2>
<ul>
<li><a href="https://e-sh4rk.github.io/ACE3/emerald/hex-writer/hex-writer/">E-Sh4rk's original article for the hexwriter, crafting egg, and CPSR status reset</a></li>
<li><a href="https://gist.github.com/Adrichu00/49433953af9d6fd7c1cd368d48c68778">Adrichu00's method of writing the hexwriter</a></li>
<li>RationalPsycho on the Glitch City Research Institute Discord for the glitched mail inputs</li>
<li>merrp of the Glitch City Research Institute Discord for showing off various cool tricks with ARM assembly</li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>The writable scaled register offsets are:</p>
<ul>
<li><code>LSL</code> with <code>rm</code> as <code>r0</code>, and <code>shift_imm</code> being an even value</li>
<li><code>LSR</code> with <code>rm</code> as <code>r1</code> to <code>lr</code>, and <code>shift_imm</code> being an odd value</li>
<li><code>ASR</code> with <code>rm</code> as <code>r0</code> to <code>pc</code>, and <code>shift_imm</code> being an odd value</li>
<li>There are probably more not covered, but these are the more useful operations.</li>
</ul>
<p><a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Due to the ACE entrypoint of 0x351 having both bit 0 unset, and bit 1 set, the <code>pc</code> register is not word-aligned which affects <code>pc</code>-relative operations.
Specifically, it is +0x2 from the value the <code>pc</code> register is expected to be.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>E12FFF1E for <code>BX lr</code> exit&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="March 12, 2025 02:54:16">March 12, 2025</span>
  </span>

    
    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="Contributors">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/it-is-final" class="md-author" title="@it-is-final">
          
          <img src="https://avatars.githubusercontent.com/u/52998298?v=4&size=72" alt="it-is-final">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">pokemon-ace-notes</span> is licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" alt=""></a></p>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>